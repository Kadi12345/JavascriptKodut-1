"use strict";let selectedState=null,activeTaxRate=null;const STATE_SELECTOR=document.getElementById("state-select"),PRODUCT_SELECTOR=document.getElementById("product-select"),SHOPPING_CART=document.getElementById("shopping-cart");function onStateChange(e){selectedState=e,activeTaxRate=STATES[e].taxrate,calculateAndShowTotals(),console.log(e),localStorage.setItem("state",e),document.getElementById("selected-state").innerHTML=STATES[e].name,document.getElementById("taxrate").innerHTML=`(${activeTaxRate} %)`}function getDiscountPercent(e){if(isNaN(e))throw"Input must be a number!";let t=0;return e>=1e3&&e<5e3?t=3:e>=5e3&&e<7e3?t=5:e>=7e3&&e<1e4?t=7:e>=1e4&&e<5e4?t=10:e>=5e4&&(t=15),t}function addToShoppingCart(e){if(!0===updateRowIfProductExistsInCart(e))return;const t=SHOPPING_CART.getElementsByTagName("tbody")[0].insertRow(-1),n=Date.now()+Math.random().toString(36).substr(2,9);t.id=n,t.dataset.productId=e.id,t.dataset.rowTotal=e.price,t.dataset.productPrice=e.price;for(let a=0;a<5;a++){const o=t.insertCell(t.cells.length);if(0===a)o.innerHTML=e.name;else if(1===a)o.innerHTML="$ "+e.price;else if(2===a){let e=document.createElement("input");e.className+="product-quantity form-control form-control-sm",e.type="number",e.min=1,e.value=1,e.dataset.row=n,o.appendChild(e)}else if(3===a){let e=document.createElement("button");e.className+="btn btn-sm btn-danger remove-product",e.type="button",e.dataset.row=n,e.innerHTML="Remove",o.appendChild(e)}else 4===a&&(o.innerHTML="$ "+e.price)}document.getElementById("checkout-btn").disabled=!1}function updateRowIfProductExistsInCart(e){const t=document.querySelector('[data-product-id="'+e.id+'"]')||!1;if(!1!==t){const e=t.getElementsByTagName("input")[0];e.value=parseInt(e.value)+1,calculateRowTotal(t.id)}return!1!==t}function calculateRowTotal(e){const t=document.getElementById(e),n=(parseInt(t.getElementsByTagName("input")[0].value)*parseFloat(t.dataset.productPrice)).toFixed(2),a=t.cells[4];t.dataset.rowTotal=n,a.innerHTML="$ "+n}function calculateAndShowTotals(){const e=calculateSubtotal(),t=getDiscountPercent(e),n=calculateDiscountSum(e,t),a=calculateTaxSum(e-n,activeTaxRate),o=(e-n+a).toFixed(2);document.getElementById("discount").innerHTML=`(${t} %)`,document.getElementById("discount-calculated").innerHTML="$ "+n.toFixed(2),document.getElementById("subtotal-calculated").innerHTML="$ "+e.toFixed(2),document.getElementById("tax-calculated").innerHTML="$ "+a.toFixed(2),document.getElementById("grand-total-calculated").innerHTML="$ "+o,document.getElementById("cart-total").innerHTML=o}function calculateSubtotal(){const e=SHOPPING_CART.tBodies[0].rows;let t=0;for(let n=0;n<e.length;n++)t+=parseFloat(e[n].dataset.rowTotal);return parseFloat(t>0?t.toFixed(2):0)}function calculateDiscountSum(e=0,t=0){if(isNaN(e)||isNaN(t))throw"Only numeric parameters allowed!";return parseFloat(t>0?(parseInt(t)/100*e).toFixed(2):0)}function calculateTaxSum(e,t=0){if(isNaN(e)||isNaN(t))throw"Only numeric parameters allowed!";return parseFloat(((t>0?parseFloat(t)/100:1)*(e>0?parseFloat(e):0)).toFixed(2))}function initProductSelection(){for(let e=0;e<PRODUCTS.length;e++){let t=document.createElement("option"),n=PRODUCTS[e];t.text=n.name+" - $ "+n.price,t.dataset.name=n.name,t.dataset.price=n.price,t.dataset.id=n.id,PRODUCT_SELECTOR.add(t)}}function initStateSelection(){for(let e in STATES)if(STATES.hasOwnProperty(e)){let t=document.createElement("option");t.text=STATES[e].name,t.value=e,STATE_SELECTOR.add(t)}onStateChange(STATE_SELECTOR.options[STATE_SELECTOR.selectedIndex].value)}function initEventListeners(){STATE_SELECTOR.addEventListener("change",function(){onStateChange(this.value),document.getElementById("close-configuration-modal-btn").click()}),SHOPPING_CART.addEventListener("click",function(e){const t=e.target;if((!t||"BUTTON"===t.tagName)&&t.classList.contains("remove-product")){const e=document.getElementById(t.dataset.row);e.parentNode.removeChild(e),calculateAndShowTotals(),SHOPPING_CART.tBodies[0].rows.length<1&&(document.getElementById("checkout-btn").disabled=!0)}}),document.getElementById("add-to-cart-btn").addEventListener("click",function(){const e=PRODUCT_SELECTOR.options[PRODUCT_SELECTOR.selectedIndex],t={name:e.dataset.name,price:e.dataset.price,id:e.dataset.id};document.getElementById("close-product-selection-modal-btn").click(),addToShoppingCart(t),calculateAndShowTotals()}),SHOPPING_CART.addEventListener("input",function(e){const t=e.target;t&&"INPUT"!==t.tagName||t.classList.contains("product-quantity")&&(calculateRowTotal(t.dataset.row),calculateAndShowTotals())}),document.getElementById("card-payment-chekbox").addEventListener("change",function(){this.checked?(document.getElementById("cash-operations-wrapper").style.display="none",document.getElementById("finalize-checkout-btn").disabled=!1):(document.getElementById("cash-operations-wrapper").style.display="block",document.getElementById("finalize-checkout-btn").disabled=!0)}),document.getElementById("finalize-checkout-btn").addEventListener("click",function(){SHOPPING_CART.tBodies[0].innerHTML="",calculateAndShowTotals(),document.getElementById("checkout-btn").disabled=!0,document.getElementById("close-checkout-modal-btn").click()}),document.getElementById("cash-received-input").addEventListener("input",function(){const e=this.value.replace(/,/,"."),t=(parseFloat(e)-parseFloat(document.getElementById("cart-total").innerHTML)).toFixed(2);document.getElementById("cash-back-input").value=t,document.getElementById("finalize-checkout-btn").disabled=t<0})}function initApp(){initStateSelection(),initProductSelection(),initEventListeners(),window.addEventListener("beforeunload",function(e){e.returnValue=null})}